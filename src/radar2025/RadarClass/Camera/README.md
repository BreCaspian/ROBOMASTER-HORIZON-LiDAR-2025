# Camera 相机驱动与视频录制模块

## 模块概述

Camera 模块是雷达站的核心图像采集组件，提供工业相机驱动和视频录制功能。

支持海康威视与迈德威视两种工业相机，接口统一，可无缝切换，并具备高性能录制能力。

------

## 架构设计

- **双驱动架构**：通过 `config.h` 宏定义选择驱动，编译时只编译对应代码，避免依赖冲突。
- **线程安全**：互斥锁保护访问，帧率计算采用线程安全滑动窗口算法，支持多线程并发。

------

## 文件结构

```
Camera/
├── include/
│   ├── camera.h          # 相机接口
│   └── VideoRecorder.h   # 视频录制接口
└── src/
    ├── camera.cpp        # 相机驱动实现
    └── VideoRecorder.cpp # 视频录制实现
```

------

## 相机驱动模块

### 支持相机类型

- **海康威视**：MVS SDK，GigE/USB3.0，BGR8 格式。
- **迈德威视**：MVSDK，USB3.0，BGR24 格式。

### 主要功能

- 设备枚举与连接
- 图像采集与格式转换
- 曝光与增益控制（自动/手动）
- 帧率设置与实时监控
- 参数保存与加载

### 相机线程管理

- 生命周期管理
- 线程安全读取
- 实时帧率计算
- 自动重连
- 参数实时调节

------

## 实时帧率计算

- 基于滑动窗口（10 帧历史）平滑计算
- 毫秒级精度
- 自动过滤异常值

------

## 参数配置

- 配置文件：支持加载/保存，失败时使用默认值。
- 动态调节：曝光（≥5000us）、增益（自动/手动）、帧率（5–19fps）。

------

## 视频录制模块

### 主要功能

- 自动创建目录
- 时间戳文件命名
- MP4 格式，H.264 编码
- 异步写入，低延迟

------

## 配置与使用

- **驱动选择**：在 `config.h` 里定义 `USE_HIKVISION_CAMERA` 或 `USE_MINDVISION_CAMERA`。
- **相机标定文件**：`params/camera0.SJTU.yaml`（内参、畸变系数、外参矩阵）。

------

## 性能特性

- **图像采集**：分辨率 1280×1024，可配帧率 5–19fps，采集延迟 <50ms。
- **视频录制**：60fps 固定，写入延迟 <10ms，支持长时录制，1 分钟约 100MB。

------

## 注意事项

- 驱动切换需重新编译，并更新标定文件。
- 曝光过长会模糊，增益过高会噪声，帧率需兼顾算力。
- 录制需保证目录权限和磁盘空间，避免频繁启停。

------

## 技术特点

- 统一接口设计，条件编译支持多驱动。
- 完善的线程安全机制。
- 实时性能监控与日志。
- 模块化，可扩展性强，支持自动重连与恢复。

---
