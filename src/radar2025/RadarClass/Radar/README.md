# Radar 雷达系统主控模块

## 模块概述

Radar模块是ROBOMASTER2025-HORIZON战队雷达站系统的核心控制中心，负责整个系统的初始化、多线程管理、数据流控制和各子模块的协调工作。

该模块集成了点云处理、目标检测、深度计算、跟踪预测、串口通信等功能，是整个雷达系统的中心。

## 系统架构

### 核心功能模块
- **点云处理**: 激光雷达数据接收、降采样、深度图生成
- **目标检测**: 装甲板检测、车辆检测、运动目标分割
- **深度融合**: 点云深度信息与检测框的融合计算
- **目标跟踪**: ByteTracker、DeepSort多种跟踪算法支持
- **坐标映射**: 3D世界坐标与2D图像坐标的转换
- **通信控制**: 串口通信、ROS消息发布、裁判系统交互

### 多线程架构
- **主处理线程**: 图像处理和目标检测的核心流水线
- **点云接收线程**: ROS点云消息的实时接收和处理
- **串口通信线程**: 读写分离的双向串口通信
- **视频录制线程**: 实时视频数据的录制和存储
- **ROS自旋线程**: ROS消息循环和回调处理

## 文件结构

```
Radar/
├── include/
│   └── Radar.h          # 雷达主控模块接口定义
└── src/
    └── Radar.cpp        # 雷达主控模块实现
```

## 核心功能

### 系统初始化与配置
- **参数加载**: 从ROS参数服务器加载配置参数
- **模块初始化**: 相机、检测器、跟踪器等子模块的初始化
- **线程管理**: 多线程的创建、启动和生命周期管理
- **资源分配**: 内存预分配和共享资源的初始化

### 点云数据处理
- **实时接收**: 通过ROS订阅激光雷达点云数据
- **降采样处理**: 支持体素网格、随机采样、均匀采样三种方法
- **深度图生成**: 将3D点云投影到2D图像平面生成深度图
- **可视化渲染**: 点云在相机图像上的实时可视化显示

### 目标检测与跟踪
- **多层检测**: 装甲板检测和车辆检测的分层处理
- **深度融合**: 检测框区域内的深度信息计算和融合
- **目标过滤**: 基于置信度和ID的目标筛选和去重
- **跟踪算法**: ByteTracker和DeepSort的集成支持

### 坐标系统与定位
- **四点标定**: 相机与世界坐标系的标定和变换
- **3D定位**: 目标在世界坐标系中的精确定位
- **位置预测**: 基于历史轨迹的运动预测
- **区域显示**: 比赛场地区域的可视化标注

### 通信与控制
- **串口通信**: 与下位机的双向数据传输
- **ROS发布**: 目标位置信息的实时发布
- **裁判系统**: 与裁判系统的通信协议实现
- **GUI控制**: 实时参数调整和状态监控



## 数据流架构

### 输入数据流
1. **激光雷达点云** → 点云处理 → 深度图生成
2. **相机图像** → 目标检测 → 检测框输出
3. **串口数据** → 协议解析 → 控制指令

### 处理流水线
1. **数据融合** → 深度信息与检测框融合
2. **坐标变换** → 图像坐标到世界坐标转换
3. **目标跟踪** → 多帧目标关联和轨迹预测
4. **结果输出** → ROS消息发布和串口发送

### 输出数据流
1. **目标位置** → ROS话题发布
2. **控制指令** → 串口数据发送
3. **可视化图像** → GUI显示和视频录制
4. **日志信息** → 文件记录和控制台输出

---

**注意**: 该模块是整个雷达系统的核心，需要确保所有依赖模块正确初始化后才能正常工作。