# UART 串口通信模块

## 模块概述

UART模块是ROBOMASTER2025-HORIZON战队雷达站系统的通信核心，负责与裁判系统进行数据交换。该模块实现了完整的裁判系统通信协议，确保雷达站与比赛系统的实时同步。

## ROBOMASTER2025超级对抗赛时更新为最新协议--2025-5-10

## 系统架构

### 核心组件
- **UART主控制器**: 协议解析和数据路由的核心控制器
- **串口驱动**: 底层串口硬件的抽象接口
- **数据传递器**: 比赛数据的缓存和传递管理
- **协议处理器**: 裁判系统协议的编解码实现
- **测试工具**: 串口通信的调试和测试功能

### 通信协议
- **发送协议**: 机器人位置信息发送
- **数据校验**: CRC8/CRC16校验确保数据完整性
- **错误处理**: 协议错误检测和恢复机制

## 文件结构

```
UART/
├── include/
│   ├── GameData.h              # 比赛数据结构定义
│   ├── UART.h                  # UART主控制器接口
│   ├── UARTPasser.h            # 数据传递器接口
│   ├── UARTTester.h            # 串口测试工具接口
│   ├── offical_Judge_Handler.h # 官方裁判系统处理器
│   └── serial.h                # 串口驱动接口
└── src/
    ├── UART.cpp                # UART主控制器实现
    ├── UARTPasser.cpp          # 数据传递器实现
    ├── UARTTester.cpp          # 串口测试工具实现
    └── serial.cpp              # 串口驱动实现
```

---

## 核心功能

### 裁判系统通信
- **位置发送**: 向裁判系统发送检测到的机器人位置信息

### 测试与调试
- **自动化测试**: 模拟机器人位置数据的自动发送
- **参数配置**: 可调节的测试间隔和数据内容
- **日志记录**: 详细的通信日志和错误记录
- **状态监控**: 实时的通信状态和性能监控

### UARTTester类 - 测试工具
**测试控制方法**:
- start(): 启动测试线程
- stop(): 停止测试线程
- setTestInterval(): 设置测试数据发送间隔
- testThreadFunction(): 测试线程主函数

**数据发送方法**:
- sendAllRobotPositions(): 发送所有机器人位置数据

### MySerial类 - 串口驱动
**串口管理方法**:
- initSerial(): 初始化串口设备
- _is_open(): 检查串口连接状态
- msread(): 串口数据读取
- mswrite(): 串口数据写入（线程安全）



## 协议支持

### 接收协议
- **0x0001**: 比赛状态数据
- **0x0002**: 比赛结果数据
- **0x0003**: 机器人血量数据
- **0x0004**: 飞镖发射状态
- **0x0101**: 场地事件数据
- **0x0102**: 补给站动作数据
- **0x0104**: 裁判警告信息
- **0x0105**: 飞镖剩余时间
- **0x0203**: 机器人位置信息
- **0x0301**: 机器人间通信数据

### 发送协议
- **0x0305**: 雷达机器人位置数据
- **0x0301**: 机器人间通信数据

### 数据格式
- **位置数据**: 浮点坐标转换为厘米精度的16位整数
- **血量数据**: 16位整数表示的血量值
- **时间数据**: 秒为单位的时间戳
- **状态数据**: 位域编码的状态信息



## 配置参数

### 串口配置
- **设备路径**: /dev/ttyUSB0 或其他串口设备
- **波特率**: 115200 bps
- **数据位**: 8位
- **停止位**: 1位
- **校验位**: 无校验

### 通信参数
- **发送频率**: 最大10Hz（符合协议要求）
- **缓冲大小**: 200字节数据缓冲
- **超时设置**: 150ms读取超时
- **重试机制**: 自动重连和错误恢复

### 测试参数
- **测试间隔**: 100-1000ms可调
- **数据内容**: 可配置的机器人位置数据
- **日志级别**: DEBUG/INFO/WARN/ERROR

---

**注意**: 严格遵循RoboMaster官方裁判系统通信协议，确保与比赛系统的完全兼容。